<!DOCTYPE html>
<html xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta charset="utf-8">
    <title>首页--layui后台管理模板 2.0</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="/static/layui/css/layui.css" media="all"/>
    <link rel="stylesheet" href="/static/css/public.css" media="all"/>
    <link rel="stylesheet" href="/static/jointjs/css/joint.css" media="all"/>
</head>
<body>

<div style="margin-left: 300px;margin-top: 100px;font-size: 20px;">
    <ul style="text-align: left;">
        <li style="margin-top: 10px;">1.权限配置（已经添加好，请勿随意改动）</li>
        <li style="margin-top: 10px;">2.角色维护 根据不同角色选择相应权限</li>
        <li style="margin-top: 10px;">3.部门维护 （先添加部门，部门主管需在用户维护完之后修改,根部门请勿随意删除和修改）</li>
        <li style="margin-top: 10px;">4.用户维护</li>
        <li style="margin-top: 10px;">5.项目管理</li>
    </ul>
</div>
<div style="margin-left: 100px;margin-top: 100px;font-size: 15px; color: red">
    说明：此为初版，还有些bug，具体功能等领导看完，再全面修改！
</div>
<!-- 设置border="1"以显示表格框线 -->
<table border="1">
    <!-- caption元素可以生成表标题，其单元格列跨度为表格的列数 -->
    <caption>学生成绩表</caption>
    <tr>
        <!-- 可以使用rowspan和colspan来合并单元格 -->
        <th rowspan="2">编号</th>
        <th rowspan="2">学号</th>
        <th rowspan="2">姓名</th>
        <th rowspan="2">性别</th>
        <th rowspan="2">年龄</th>
        <th colspan="3">成绩</th>
    </tr>
    <tr>
        <th>语文</th>
        <th>数学</th>
        <th>英语</th>
    </tr>
    <tr>
        <td>1</td>
        <td>2016001</td>
        <td>张三</td>
        <td>男</td>
        <td>13</td>
        <td>85</td>
        <td>94</td>
        <td>77</td>
    </tr>
    <tr>
        <td>2</td>
        <td>2016002</td>
        <td>李四</td>
        <td>女</td>
        <td>12</td>
        <td>96</td>
        <td>84</td>
        <td>89</td>
    </tr>
</table>
<button onclick="outexcel1()">导出excel</button>


</body>
<script src="/static/xlsx/xlsx.core.min.js"></script>
<script type="text/javascript" src="/static/jointjs/jquery-3.3.1.js"></script>
<script>
    function outexcel1() {
        var aoa = [
            ['姓名', '性别', '年龄', '注册时间'],
            ['张三', '男', 18, new Date()],
            ['李四', '女', 22, new Date()]
        ];
        var sheet = XLSX.utils.aoa_to_sheet(aoa);
        openDownloadDialog(sheet2blob(sheet), '导出.xlsx');
    }

    function outexcel2() {
        console.log($('table')[0]);
        XLSX.utils.table_to_sheet($('table')[0])
    }

    // csv转sheet对象
    function csv2sheet(csv) {
        var sheet = {}; // 将要生成的sheet
        csv = csv.split('\n');
        csv.forEach(function (row, i) {
            row = row.split(',');
            if (i == 0) sheet['!ref'] = 'A1:' + String.fromCharCode(65 + row.length - 1) + (csv.length - 1);
            row.forEach(function (col, j) {
                sheet[String.fromCharCode(65 + j) + (i + 1)] = {v: col};
            });
        });
        return sheet;
    }

    // 将一个sheet转成最终的excel文件的blob对象，然后利用URL.createObjectURL下载
    function sheet2blob(sheet, sheetName) {
        sheetName = sheetName || 'sheet1';
        var workbook = {
            SheetNames: [sheetName],
            Sheets: {}
        };
        workbook.Sheets[sheetName] = sheet;
        // 生成excel的配置项
        var wopts = {
            bookType: 'xlsx', // 要生成的文件类型
            bookSST: false, // 是否生成Shared String Table，官方解释是，如果开启生成速度会下降，但在低版本IOS设备上有更好的兼容性
            type: 'binary'
        };
        var wbout = XLSX.write(workbook, wopts);
        var blob = new Blob([s2ab(wbout)], {type: "application/octet-stream"});

        // 字符串转ArrayBuffer
        function s2ab(s) {
            var buf = new ArrayBuffer(s.length);
            var view = new Uint8Array(buf);
            for (var i = 0; i != s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;
            return buf;
        }

        return blob;
    }

    /**
     * 通用的打开下载对话框方法，没有测试过具体兼容性
     * @param url 下载地址，也可以是一个blob对象，必选
     * @param saveName 保存文件名，可选
     */
    function openDownloadDialog(url, saveName) {
        if (typeof url == 'object' && url instanceof Blob) {
            url = URL.createObjectURL(url); // 创建blob地址
        }
        var aLink = document.createElement('a');
        aLink.href = url;
        aLink.download = saveName || ''; // HTML5新增的属性，指定保存文件名，可以不要后缀，注意，file:///模式下不会生效
        var event;
        if (window.MouseEvent) {
            event = new MouseEvent('click');
        } else {
            event = document.createEvent('MouseEvents');
            event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
        }
        aLink.dispatchEvent(event);
    }

</script>
</html>